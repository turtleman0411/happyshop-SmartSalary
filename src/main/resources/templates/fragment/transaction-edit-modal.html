<!-- ================= Edit Transaction Modal ================= -->
<div class="modal fade" id="editModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
    <div class="modal-content rounded-4">

      <div class="modal-header border-0">
        <h5 class="fw-bold">✏️ 修改消費</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <form method="post"
            th:action="@{/happyshop/transaction/update(month=${view.month})}"
            enctype="multipart/form-data">

        <div class="modal-body px-4">

          <p class="text-muted small mb-3">
            只允許修改：金額 / 備註 / 圖片（分類與日期不可更改）
          </p>

          <!-- ✅ 必要隱藏欄位 -->
          <input type="hidden" name="transactionId" id="editTransactionId">

          <!-- ===== 顯示（唯讀）：日期 ===== -->
          <div class="mb-3">
            <label class="form-label small text-muted">消費日期（不可改）</label>
            <input type="text"
                   class="form-control bg-light"
                   id="editDateText"
                   readonly>
          </div>

          <!-- ===== 顯示（唯讀）：分類 + 預算狀態（沿用 add 的區塊外觀） ===== -->
          <div class="border rounded-4 p-3 mb-4 bg-light">
            <div class="d-flex justify-content-between mb-1">
              <strong id="editCategoryDisplay">-</strong>
              <span class="text-muted small">
                <span id="editSpent">0</span> /
                <span id="editBudget">0</span>
              </span>
            </div>

            <div class="small mb-1">
              剩餘：<strong id="editRemaining">0</strong>
              <span class="text-danger ms-2" id="editOverWrap" style="display:none;">
                超額：<strong id="editOver">0</strong>
              </span>
              <span class="ms-2">
                使用率：<strong id="editUsage">0%</strong>
              </span>
            </div>

            <div class="progress" style="height:10px;">
              <div class="progress-bar" id="editBar"></div>
            </div>
          </div>

          <!-- ✅ 可改：金額 -->
          <div class="mb-3">
            <label class="form-label fw-bold">消費金額</label>
            <input type="number"
                   class="form-control"
                   id="editAmount"
                   name="amount"
                   min="0"
                   required>
          </div>

          <!-- ✅ 可改：備註 -->
          <div class="mb-3">
            <label class="form-label small text-muted">備註（選填）</label>
            <textarea class="form-control"
                      name="note"
                      id="editNote"
                      rows="2"></textarea>
          </div>

          <!-- ✅ 可改：圖片 -->
          <div class="mb-3">
            <label class="form-label fw-bold">📷 交易圖片（選填）</label>
            <input type="file"
                   class="form-control"
                   name="image"
                   id="editImage"
                   accept="image/*">
            <small class="text-muted">未選擇代表不更換圖片</small>
          </div>

          <!-- 目前圖片（顯示用，不上傳） -->
          <div id="editCurrentImageWrap" style="display:none;">
            <div class="small text-muted mb-2">目前圖片</div>
            <img id="editCurrentImage"
                 class="img-fluid rounded-3 border"
                 style="max-height:200px;">
          </div>

          <!-- 新選擇圖片預覽 -->
          <div id="editImagePreviewWrap" style="display:none;" class="mt-3">
            <div class="small text-muted mb-2">新圖片預覽</div>
            <img id="editImagePreview"
                 class="img-fluid rounded-3 border"
                 style="max-height:200px;">
          </div>

        </div>

        <div class="modal-footer border-0">
          <button class="btn btn-outline-secondary"
                  data-bs-dismiss="modal">取消</button>
          <button class="btn btn-primary px-4">儲存修改</button>
        </div>

      </form>
    </div>
  </div>
</div>
